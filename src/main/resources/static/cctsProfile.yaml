CCTSversion: "0.5"
title: CCTS saga test case1
startAt: Create top-up event
states:
  Create top-up event:
    comment: initial state
    end: False
    nextState:
      contractName: payment process contract
      state: payment process
      publisher: Orchestrator
      subscriber: Payment
  Payment process:
    comment: make payment
    end: False
    options:
      Prepare update point:
        contractName:  make payment contract
        publisher: Payment
        subscriber: Orchestrator
      Payment Fail:
        contractName:  Payment Fail response
        publisher: Payment
        subscriber: Orchestrator
  Payment Fail:
    comment: do payment fail compensation
    end: False
    nextState:
      state: Payment reversed
      contractName: Payment Fail response
      publisher: Orchestrator
      subscriber: Payment
  Payment reversed:
    comment: reverse Payment
    end: False
    nextState:
      state: Top-up cancel
      contractName: compensation done and cancel saga
      publisher: Payment
      subscriber: Orchestrator
  Prepare update point:
    comment: orchestrator received response from payment and ready to send update point request to Point service
    end: False
    nextState:
      state: Update point
      contractName: update point request contract
      publisher: Orchestrator
      subscriber: Point
  Upate point:
    comment: do update point
    end: False
    options:
      Prepare log:
        contractName: response orchestrator contract
        publisher: Point
        subscriber: Orchestrator
      Update point Fail:
        contractName: notify orchestrator revert point contract
        publisher: Point
        subscriber: Orchestrator
  Update point Fail:
    comment: revert points
    end: False
    nextState:
      state: Revert point
      contractName: orchestrator request Point service revert point
      publisher: Orchestrator
      subscriber: Point
  Revert point:
    comment: revert points
    end: False
    nextState:
      state: Prepare reverse payment
      contractName: notify orchestrator do compensation for payment contract
      publisher: Point
      subscriber: Orchestrator
  Prepare reverse payment:
    comment: orchestrator received response that point finished compensation , ready to do payment compensation
    end: False
    nextState:
      state: Payment reverse
      contractName: request payment do compensation contract
      publisher: Orchestrator
      subscriber: Payment
  Prepare Log:
    comment: orchestrator ready to send Log request
    end: False
    nextState:
      state: Log
      contractName: Log request Contract
      publisher: Orchestrator
      subscriber: Log
  Log:
    comment: logging
    end: False
    nextState:
      state: Approved top-update
      contractName: log response contract
      publisher: Log
      subscriber: Orchestrator
  Approved top-up:
    comment: finishe saga process
    end: True
  Top-up cancel:
    comment: finishe compensation process and finishe saga
    end: True