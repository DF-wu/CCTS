CCTSversion: "0.9"
title: CCTS saga test case1
caseSequence:
  - 1,2,6,9,8
  - 1,5,6,9,10
startAt: Create top-up event
states:
  Create top-up event:
    comment: initial state
    isEnd: False
    nextState:
      stateName: payment process
      timeSequenceLable: 1
      testCaseId: t-orc-payment-01
      provider: orchestrator
      consumer: paymentService
  Payment process:
    comment: make payment
    isEnd: False
    options:
      Prepare update point:
        stateName: Prepare update point
        timeSequenceLable: 2
        testCaseId: t-payment-orc-01
        provider: paymentService
        consumer: orchestrator
      Payment Fail:
        stateName: Payment Fail
        timeSequenceLable: 7
        testCaseId: t-payment-orc-02
        provider: paymentService
        consumer: orchestrator
  Payment Fail:
    comment: do payment fail compensation
    isEnd: False
    nextState:
      stateName: Payment reversed
      timeSequenceLable: 8
      testCaseId: t-orc-payment-02
      provider: orchestrator
      consumer: paymentService
  Payment reversed:
    comment: reverse Payment
    isEnd: False
    nextState:
      stateName: Top-up cancel
      timeSequenceLable: 13
      testCaseId: t-payment-orc-04
      provider: paymentService
      consumer: orchestrator
  Prepare update point:
    comment: orchestrator received response from payment and ready to send update point request to Point service
    isEnd: False
    nextState:
      stateName: Update point
      timeSequenceLable: 3
      testCaseId: t-orc-point-01
      provider: orchestrator
      consumer: pointService
  Upate point:
    comment: do update point
    isEnd: False
    options:
      Prepare log:
        stateName: Prepare log
        timeSequenceLable: 4
        testCaseId: t-point-orc-01
        provider: pointService
        consumer: orchestrator
      Update point Fail:
        stateName: Update point Fail
        timeSequenceLable: 9
        testCaseId: t-point-orc-02
        provider: pointService
        consumer: orchestrator
  Update point Fail:
    comment: revert points
    isEnd: False
    nextState:
      stateName: Revert point
      timeSequenceLable: 10
      testCaseId: t-orc-point-02
      provider: orchestrator
      consumer: pointService
  Revert point:
    comment: revert points
    isEnd: False
    nextState:
      stateName: Prepare reverse payment
      timeSequenceLable: 11
      testCaseId: t-point-orc-03
      provider: pointService
      consumer: orchestrator
  Prepare reverse payment:
    comment: orchestrator received response that point finished compensation , ready to do payment compensation
    isEnd: False
    nextState:
      stateName: Payment reversed
      timeSequenceLable: 12
      testCaseId: t-orc-payment-03
      provider: orchestrator
      consumer: paymentService
  Prepare Log:
    comment: orchestrator ready to send Log request
    isEnd: False
    nextState:
      stateName: Log
      timeSequenceLable: 5
      testCaseId: t-orc-logging-01
      provider: orchestrator
      consumer: loggingService
  Log:
    comment: logging
    isEnd: False
    nextState:
      stateName: Approved top-update
      timeSequenceLable: 6
      testCaseId: t-logging-orc-01
      provider: loggingService
      consumer: orchestrator
  Approved top-up:
    comment: finishe saga process
    isEnd: True
  Top-up cancel:
    comment: finishe compensation process and finishe saga
    isEnd: True
