CCTSversion: "0.6"
title: CCTS saga test case1
startAt: Create top-up event
states:
  Create top-up event:
    comment: initial state
    end: False
    nextState:
      stateName: payment process
      testCaseId: poc-01
      provider: Orchestrator
      consumer: Payment
  Payment process:
    comment: make payment
    end: False
    options:
      Prepare update point:
        testCaseId: poc-02
        provider: Payment
        consumer: Orchestrator
      Payment Fail:
        testCaseId: poc-03
        provider: Payment
        consumer: Orchestrator
  Payment Fail:
    comment: do payment fail compensation
    end: False
    nextState:
      testCaseId: poc-04
      stateName: Payment reversed
      provider: Orchestrator
      consumer: Payment
  Payment reversed:
    comment: reverse Payment
    end: False
    nextState:
      testCaseId: poc-05
      stateName: Top-up cancel
      provider: Payment
      consumer: Orchestrator
  Prepare update point:
    comment: orchestrator received response from payment and ready to send update point request to Point service
    end: False
    nextState:
      testCaseId: poc-06
      stateName: Update point
      provider: Orchestrator
      consumer: Point
  Upate point:
    comment: do update point
    end: False
    options:
      Prepare log:
        testCaseId: poc-07
        provider: Point
        consumer: Orchestrator
      Update point Fail:
        testCaseId: poc-08
        provider: Point
        consumer: Orchestrator
  Update point Fail:
    comment: revert points
    end: False
    nextState:
      testCaseId: poc-08
      stateName: Revert point
      provider: Orchestrator
      consumer: Point
  Revert point:
    comment: revert points
    end: False
    nextState:
      testCaseId: poc-09
      stateName: Prepare reverse payment
      provider: Point
      consumer: Orchestrator
  Prepare reverse payment:
    comment: orchestrator received response that point finished compensation , ready to do payment compensation
    end: False
    nextState:
      testCaseId: poc-10
      stateName: Payment reverse
      provider: Orchestrator
      consumer: Payment
  Prepare Log:
    comment: orchestrator ready to send Log request
    end: False
    nextState:
      testCaseId: poc-11
      stateName: Log
      provider: Orchestrator
      consumer: Log
  Log:
    comment: logging
    end: False
    nextState:
      testCaseId: poc-12
      stateName: Approved top-update
      provider: Log
      consumer: Orchestrator
  Approved top-up:
    comment: finishe saga process
    end: True
  Top-up cancel:
    comment: finishe compensation process and finishe saga
    end: True
